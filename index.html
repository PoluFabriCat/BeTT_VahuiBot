<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#070A12" />
  <title>–î–ª—è –î–∂–∞–º—ã üíå</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1021;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.09);
      --stroke:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --shadow2: 0 10px 28px rgba(0,0,0,.38);
      --pink:#ff4da6;
      --pink2:#ff85c7;
      --gold:#f6d36b;
      --ok:#37d67a;
      --bad:#ff4b4b;

      --radius:22px;
      --radius2:16px;
      --ease: cubic-bezier(.2,.8,.2,1);
      --ui: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--ui);
      color:var(--text);
      background:
        radial-gradient(1100px 800px at 20% 10%, rgba(255,77,166,.18), transparent 55%),
        radial-gradient(900px 700px at 85% 25%, rgba(246,211,107,.14), transparent 58%),
        radial-gradient(900px 900px at 55% 95%, rgba(87,142,255,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* subtle pixel vibe */
    .pixelize{
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    .app{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: clamp(10px, 2.3vw, 22px);
    }

    .stage{
      width:min(1020px, 100%);
      height:min(720px, 100%);
      position:relative;
      border-radius: clamp(18px, 2.6vw, 30px);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;

      /* CRT-ish */
      filter: saturate(1.03) contrast(1.02);
    }

    /* CRT overlay: scanlines + vignette + noise */
    .crtOverlay{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 40;
      mix-blend-mode: overlay;
      opacity:.38;
      background:
        repeating-linear-gradient(
          180deg,
          rgba(255,255,255,.08),
          rgba(255,255,255,.08) 1px,
          rgba(0,0,0,.00) 3px,
          rgba(0,0,0,.00) 6px
        );
    }
    .crtVignette{
      position:absolute;
      inset:-2px;
      pointer-events:none;
      z-index: 41;
      background: radial-gradient(110% 85% at 50% 50%, transparent 55%, rgba(0,0,0,.35) 100%);
      opacity:.75;
    }
    .crtNoise{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 42;
      opacity:.10;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      animation: noiseMove 1.1s steps(2,end) infinite;
    }
    @keyframes noiseMove{
      0%{ transform: translate3d(0,0,0) }
      25%{ transform: translate3d(-2px,1px,0) }
      50%{ transform: translate3d(1px,-2px,0) }
      75%{ transform: translate3d(2px,2px,0) }
      100%{ transform: translate3d(0,0,0) }
    }

    .topbar{
      position:absolute;
      inset: 0 0 auto 0;
      height: 62px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      z-index: 20;
      background: linear-gradient(180deg, rgba(0,0,0,.38), rgba(0,0,0,0));
    }
    .brand{
      display:flex;
      gap:10px;
      align-items:center;
      user-select:none;
    }
    .dot{
      width:12px;height:12px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, var(--pink));
      box-shadow: 0 0 18px rgba(255,77,166,.35);
    }
    .title{
      font-weight:780;
      letter-spacing:.2px;
      font-size: 13.5px;
      opacity:.95;
    }

    .topActions{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      user-select:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .chipBtn{
      cursor:pointer;
      border:0;
      color: rgba(255,255,255,.82);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      padding: 8px 10px;
      border-radius: 999px;
      font-weight:700;
      font-size: 12px;
      transition: transform .12s var(--ease), background .12s var(--ease);
      user-select:none;
    }
    .chipBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.08); }
    .chipBtn:active{ transform: translateY(0px) scale(.99); }

    /* Layout: left chat + main content */
    .layout{
      position:absolute;
      inset: 62px 0 0 0;
      display:grid;
      grid-template-columns: 270px 1fr;
      gap: 12px;
      padding: 14px;
      z-index: 10;
    }
    @media (max-width: 880px){
      .layout{ grid-template-columns: 1fr; }
      .chatPane{ display:none; }
    }

    .chatPane{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow2);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .chatHead{
      padding: 12px 12px 10px;
      display:flex;
      align-items:center;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.22), transparent);
    }
    .avatar{
      width: 34px; height: 34px;
      border-radius: 12px;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.22), transparent 55%),
        linear-gradient(135deg, rgba(255,77,166,.25), rgba(246,211,107,.16));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.12) inset;
      display:grid;
      place-items:center;
      font-weight:900;
      letter-spacing:.5px;
      font-family: var(--mono);
    }
    .chatMeta{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .chatMeta .name{ font-weight:850; font-size: 12.5px; letter-spacing:.2px; }
    .chatMeta .status{ font-size: 11px; color: var(--muted); }

    .chatBody{
      padding: 10px 10px 12px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:0;
    }
    .bubble{
      max-width: 100%;
      padding: 10px 11px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      position:relative;
      transform: translateY(4px);
      opacity:0;
      animation: popIn .26s var(--ease) forwards;
      font-size: 12.5px;
      line-height: 1.35;
      color: rgba(255,255,255,.86);
      word-wrap: break-word;
    }
    .bubble strong{ color: rgba(255,255,255,.95); }
    .bubble .tag{
      display:inline-block;
      margin-top: 6px;
      font-size: 11px;
      color: rgba(255,255,255,.65);
    }
    @keyframes popIn{
      to{ transform: translateY(0); opacity:1; }
    }
    .typing{
      padding: 10px 11px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.68);
      font-size: 12px;
      display:flex;
      gap:6px;
      align-items:center;
    }
    .dots{
      display:inline-flex;
      gap:4px;
    }
    .dots i{
      width:5px;height:5px;border-radius:99px;
      background: rgba(255,255,255,.55);
      display:block;
      animation: dot 1s var(--ease) infinite;
    }
    .dots i:nth-child(2){ animation-delay: .12s }
    .dots i:nth-child(3){ animation-delay: .24s }
    @keyframes dot{
      0%,100%{ transform: translateY(0); opacity:.45 }
      50%{ transform: translateY(-2px); opacity:1 }
    }

    .mainPane{
      border-radius: var(--radius);
      position:relative;
      overflow:hidden;
      min-height: 0;
    }

    .center{
      position:absolute;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }

    /* Shared UI */
    .panel{
      width:min(560px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 16px 16px 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .panel h2{
      margin:0 0 8px 0;
      font-size: 17px;
      letter-spacing:.2px;
      font-family: var(--mono);
    }
    .panel p{
      margin:0;
      color: var(--muted);
      line-height:1.45;
      font-size: 12.5px;
    }
    .row{
      display:flex;
      gap:10px;
      margin-top: 14px;
      flex-wrap:wrap;
    }
    .btn{
      border:0;
      cursor:pointer;
      user-select:none;
      padding: 12px 14px;
      border-radius: 14px;
      color: var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      transition: transform .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease), opacity .12s var(--ease);
      font-weight:750;
      letter-spacing:.15px;
      font-size: 12.5px;
      flex:1 1 160px;
      min-width: 140px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-family: var(--mono);
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .btn.primary{
      background: linear-gradient(135deg, rgba(255,77,166,.28), rgba(255,133,199,.12));
      border-color: rgba(255,77,166,.40);
      box-shadow: 0 10px 30px rgba(255,77,166,.13);
    }
    .btn.danger{
      background: linear-gradient(135deg, rgba(255,75,75,.20), rgba(255,255,255,.05));
      border-color: rgba(255,75,75,.35);
    }
    .btn.ok{
      background: linear-gradient(135deg, rgba(55,214,122,.22), rgba(255,255,255,.05));
      border-color: rgba(55,214,122,.35);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.78);
      font-size: 11.5px;
      user-select:none;
      font-family: var(--mono);
    }

    /* 3D rotatable wrapper */
    .objectWrap{
      width:min(560px, 100%);
      height:min(460px, 58vh);
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      perspective: 900px;
      touch-action:none;
      user-select:none;
    }
    .object{
      width: min(360px, 80vw);
      height: min(280px, 60vw);
      position:relative;
      transform-style: preserve-3d;
      will-change: transform;
      filter: drop-shadow(0 18px 35px rgba(0,0,0,.45));
    }

    /* Box */
    .box{
      border-radius: 22px;
      background:
        radial-gradient(140px 90px at 20% 20%, rgba(255,255,255,.22), transparent 55%),
        linear-gradient(135deg, rgba(246,211,107,.22), rgba(255,77,166,.12)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.10));
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
    }
    .box::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(90deg, rgba(0,0,0,.18), transparent 40%, rgba(255,255,255,.06) 65%, rgba(0,0,0,.18)),
        repeating-linear-gradient(0deg, rgba(255,255,255,.06), rgba(255,255,255,.06) 2px, transparent 2px, transparent 8px);
      opacity:.55;
      mix-blend-mode: overlay;
      pointer-events:none;
    }
    .boxLabel{
      position:absolute;
      left: 16px; bottom: 14px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.12);
      font-weight:900;
      letter-spacing:.4px;
      text-transform: lowercase;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-family: var(--mono);
    }
    .boxLabel span{
      background: linear-gradient(90deg, var(--pink2), var(--gold));
      -webkit-background-clip: text;
      background-clip:text;
      color: transparent;
    }

    .lock{
      position:absolute;
      top: 20px; right: 20px;
      width: 86px; height: 86px;
      border-radius: 22px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      display:grid;
      place-items:center;
      cursor:pointer;
      transform: translateZ(18px);
      box-shadow: 0 0 0 1px rgba(255,255,255,.05) inset;
    }
    .lockGlow{
      position:absolute;
      inset:-10px;
      border-radius: 28px;
      background: radial-gradient(circle at 50% 50%, rgba(255,77,166,.55), transparent 60%);
      filter: blur(10px);
      opacity:.9;
      animation: pulse 1.2s var(--ease) infinite alternate;
      pointer-events:none;
    }
    @keyframes pulse{ from{ transform: scale(.96); opacity:.55 } to{ transform: scale(1.03); opacity: .95 } }

    .lockIcon{
      width: 34px; height: 34px;
      position:relative;
    }
    .lockIcon::before{
      content:"";
      position:absolute;
      left: 7px; right: 7px; top: 16px; bottom: 2px;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.24), rgba(255,255,255,.08));
      border: 1px solid rgba(255,255,255,.18);
    }
    .lockIcon::after{
      content:"";
      position:absolute;
      width: 22px; height: 18px;
      left: 50%; top: 2px;
      transform: translateX(-50%);
      border-radius: 14px 14px 10px 10px;
      border: 3px solid rgba(255,255,255,.42);
      border-bottom: 0;
      box-shadow: 0 0 18px rgba(255,77,166,.18);
    }

    /* Envelope */
    .envelope{
      border-radius: 22px;
      background:
        radial-gradient(150px 90px at 18% 22%, rgba(255,255,255,.22), transparent 55%),
        linear-gradient(135deg, rgba(255,77,166,.16), rgba(87,142,255,.10)),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.12));
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
    }
    .envTop{
      position:absolute;
      inset:0;
      background:
        linear-gradient(0deg, transparent 54%, rgba(0,0,0,.20)),
        conic-gradient(from 225deg at 50% 52%, rgba(255,255,255,.08), rgba(255,255,255,.02), rgba(255,255,255,.08));
      opacity:.9;
      pointer-events:none;
    }
    .seal{
      position:absolute;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%) translateZ(20px);
      width: 88px; height: 88px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.22), transparent 55%),
                  linear-gradient(135deg, rgba(246,211,107,.24), rgba(255,77,166,.22));
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      font-weight:900;
      letter-spacing:.6px;
      user-select:none;
      font-family: var(--mono);
    }
    .seal span{
      background: linear-gradient(90deg, rgba(255,255,255,.92), rgba(255,255,255,.70));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      font-size: 18px;
    }

    .controls{
      position:absolute;
      inset: auto 0 0 0;
      padding: 14px 14px 16px;
      display:flex;
      gap:10px;
      justify-content:center;
      z-index: 15;
      background: linear-gradient(0deg, rgba(0,0,0,.42), rgba(0,0,0,0));
    }
    .controls .btn{ max-width: 280px; flex: 1 1 180px; }

    /* Modal */
    .modalOverlay{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.56);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 50;
      padding: 16px;
    }
    .modalOverlay.show{ display:flex; }
    .modal{
      width:min(660px, 100%);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .modalHead{
      padding: 14px 16px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.20), transparent);
    }
    .modalHead h3{ margin:0; font-size:14px; letter-spacing:.2px; font-family: var(--mono); }
    .modalHead p{ margin:4px 0 0 0; font-size:12px; color:var(--muted); line-height:1.35; }
    .modalBody{ padding: 12px 16px 14px; }

    /* Lock wheels */
    .wheels{
      display:grid;
      grid-template-columns: 1fr 1.2fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .wheel{
      height: 210px;
      border-radius: 18px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.12);
      position:relative;
      overflow:hidden;
      touch-action:none;
      user-select:none;
    }
    .wheel::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.82), transparent 28%, transparent 72%, rgba(0,0,0,.82)),
        radial-gradient(260px 140px at 50% 50%, rgba(255,77,166,.10), transparent 58%);
      pointer-events:none;
    }
    .wheel .items{
      position:absolute;
      left:0; right:0;
      top: 50%;
      transform: translateY(-50%);
      will-change: transform;
    }
    .wheel .item{
      height: 42px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      letter-spacing:.35px;
      color: rgba(255,255,255,.75);
      opacity:.8;
      transition: opacity .12s var(--ease), transform .12s var(--ease), color .12s var(--ease);
      font-family: var(--mono);
    }
    .wheel .item.active{
      color: rgba(255,255,255,.94);
      opacity: 1;
      transform: scale(1.06);
      text-shadow: 0 0 18px rgba(255,77,166,.18);
    }
    .wheel .selector{
      position:absolute;
      left:10px; right:10px;
      top: 50%;
      transform: translateY(-50%);
      height: 46px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      box-shadow: 0 0 0 1px rgba(0,0,0,.20) inset;
      pointer-events:none;
    }
    .modalActions{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap:wrap;
    }

    /* Date prompt */
    .datePrompt{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .field{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    input[type="text"]{
      flex: 1 1 220px;
      min-width: 210px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      outline:none;
      font-weight:900;
      letter-spacing:.2px;
      font-variant-numeric: tabular-nums;
      font-family: var(--mono);
    }
    input[type="text"]::placeholder{ color: rgba(255,255,255,.40); }

    /* Toast */
    .toast{
      position:absolute;
      left: 50%;
      bottom: 86px;
      transform: translateX(-50%) translateY(8px);
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.42);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.90);
      font-size: 12px;
      box-shadow: var(--shadow2);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s var(--ease), transform .18s var(--ease);
      z-index: 60;
      max-width: calc(100% - 28px);
      text-align:center;
      font-family: var(--mono);
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(0px); }

    canvas#fx{
      position:absolute;
      inset:0;
      z-index: 5;
      pointer-events:none;
    }

    .fadeIn{ animation: fadeIn .35s var(--ease) both; }
    @keyframes fadeIn{ from{ opacity:0; transform: translateY(10px) } to{ opacity:1; transform: translateY(0) } }

    .shake{ animation: shake .22s linear 1; }
    @keyframes shake{
      0%{ transform: translate3d(0,0,0) }
      20%{ transform: translate3d(-6px,2px,0) }
      40%{ transform: translate3d(6px,-2px,0) }
      60%{ transform: translate3d(-4px,1px,0) }
      80%{ transform: translate3d(4px,-1px,0) }
      100%{ transform: translate3d(0,0,0) }
    }

    /* Finale */
    .finale{
      position:absolute;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 12;
    }
    .finale.show{ display:flex; }
    .finaleGrid{
      width:min(940px, 100%);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 12px;
      align-items:stretch;
    }
    @media (max-width: 860px){
      .finaleGrid{ grid-template-columns: 1fr; }
    }
    .photoCard{
      border-radius: var(--radius);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      box-shadow: var(--shadow2);
      position:relative;
      min-height: 260px;
    }
    .photoRail{
      position:absolute;
      inset:0;
      display:flex;
      transition: transform .6s var(--ease);
    }
    .photoRail img{
      width:100%;
      height:100%;
      object-fit: cover;
      flex: 0 0 100%;
      filter: saturate(1.03) contrast(1.02);
    }
    .photoDots{
      position:absolute;
      left: 12px;
      bottom: 12px;
      display:flex;
      gap:8px;
      z-index:2;
      background: rgba(0,0,0,.30);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      padding: 8px 10px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .photoDots button{
      width: 9px; height: 9px;
      border-radius:999px;
      border:0;
      background: rgba(255,255,255,.26);
      cursor:pointer;
      padding:0;
    }
    .photoDots button.active{ background: rgba(255,255,255,.86); }

    .noteCard{
      border-radius: var(--radius);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow2);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .paper{
      border-radius: 18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.84));
      color: rgba(10,12,18,.92);
      border: 1px solid rgba(0,0,0,.08);
      padding: 18px 16px;
      box-shadow: 0 18px 50px rgba(0,0,0,.28);
      position:relative;
      overflow:hidden;
    }
    .paper::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        repeating-linear-gradient(
          180deg,
          rgba(12,16,30,.08),
          rgba(12,16,30,.08) 1px,
          transparent 1px,
          transparent 26px
        );
      opacity:.55;
      pointer-events:none;
    }
    .paper h4{
      margin:0 0 10px 0;
      font-size: 15px;
      letter-spacing:.2px;
      position:relative;
      z-index:1;
      font-family: var(--mono);
    }
    .paper p{
      margin:0;
      line-height:1.6;
      font-size: 13px;
      position:relative;
      z-index:1;
      white-space: pre-wrap;
      font-family: var(--ui);
    }
    .miniFooter{
      margin-top: 10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      color: var(--muted);
      font-size: 12px;
      font-family: var(--mono);
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
      .lockGlow{ display:none; }
      .crtNoise{ display:none; }
    }
  </style>
</head>

<body>
<div class="app">
  <div class="stage pixelize" id="stage">
    <canvas id="fx"></canvas>

    <div class="topbar">
      <div class="brand">
        <div class="dot"></div>
        <div class="title">–ü–æ—Å—ã–ª–∫–∞ –¥–ª—è –î–∂–∞–º—ã</div>
      </div>
      <div class="topActions">
        <span class="chip">‚Ü∫ —Ç—è–Ω–∏ –æ–±—ä–µ–∫—Ç –ø–∞–ª—å—Ü–µ–º</span>
        <button class="chipBtn" id="soundBtn">üîä –∑–≤—É–∫</button>
      </div>
    </div>

    <div class="layout">
      <!-- CHAT –ø–µ—Ä—Å–æ–Ω–∞–∂ -->
      <aside class="chatPane" id="chatPane">
        <div class="chatHead">
          <div class="avatar">YC</div>
          <div class="chatMeta">
            <div class="name">–Ø–Ω–¥–µ–∫—Å-–∫—É—Ä—å–µ—Ä</div>
            <div class="status" id="courierStatus">–Ω–∞ —Å–≤—è–∑–∏</div>
          </div>
        </div>
        <div class="chatBody" id="chatBody"></div>
      </aside>

      <!-- MAIN -->
      <main class="mainPane">
        <div class="center" id="center"></div>
        <div class="controls" id="controls" style="display:none;"></div>

        <div class="toast" id="toast"></div>

        <!-- Modal -->
        <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
          <div class="modal" role="dialog" aria-modal="true">
            <div class="modalHead">
              <div>
                <h3 id="modalTitle">–ó–∞–º–æ–∫</h3>
                <p id="modalSubtitle">–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥.</p>
              </div>
              <div class="badge">–∫—Ä—É—Ç–∏ ‚Üë‚Üì</div>
            </div>
            <div class="modalBody" id="modalBody"></div>
          </div>
        </div>

        <!-- Finale -->
        <div class="finale" id="finale">
          <div class="finaleGrid">
            <div class="photoCard">
              <div class="photoRail" id="photoRail"></div>
              <div class="photoDots" id="photoDots"></div>
            </div>
            <div class="noteCard">
              <div class="paper">
                <h4>–î–∂–∞–º–∞, —ç—Ç–æ —Ç–µ–±–µ üíó</h4>
                <p id="loveText"></p>
              </div>
              <div class="miniFooter">
                <span>üíå –æ—Ç —Ñ–∞–Ω–∞—Ç–∞</span>
                <span>–ª–∏—Å—Ç–∞–π —Ñ–æ—Ç–æ</span>
              </div>
            </div>
          </div>
        </div>

      </main>
    </div>

    <div class="crtOverlay"></div>
    <div class="crtNoise"></div>
    <div class="crtVignette"></div>
  </div>
</div>

<script>
(() => {
  // ================== SETTINGS ==================
  const GIRL_NAME = "–î–∂–∞–º–∞";

  // —Ñ–æ—Ç–æ: –º–∞–∫—Å–∏–º—É–º 3-4
  const PHOTO_FILES = ["Images/1.jpg", "Images/2.jpg", "Images/3.jpg", "Images/4.jpg"];

  const LOVE_TEXT =
`–Ø –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ —É —Ç–µ–±—è —ç—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è,
–Ω–æ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–∏—à–µ –∏ –¥–æ–±—Ä–µ–µ.

–¢—ã ‚Äî –º–æ–π –≤—ã–±–æ—Ä, –º–æ—è —Ä–∞–¥–æ—Å—Ç—å –∏ –º–æ–π —É—é—Ç.
–ü—É—Å—Ç—å —É –Ω–∞—Å –±—É–¥–µ—Ç –µ—â—ë —Ç—ã—Å—è—á–∞ –ø–æ–≤–æ–¥–æ–≤ —É–ª—ã–±–∞—Ç—å—Å—è.

–° –î–Ω—ë–º –≤—Å–µ—Ö –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö, –î–∂–∞–º–∞. üíó`;

  // –∑–∞–º–æ–∫ –Ω–∞ –∫–æ—Ä–æ–±–∫–µ: 5 –Ω–æ—è–±—Ä—è 2025
  const BOX_CODE = { day: 5, monthIndex: 11, year: 2025 }; // monthIndex: 1..12

  // –ø–µ—á–∞—Ç—å: 01.02.2005
  const FAN_BDAY = { d: 1, m: 2, y: 2005 };

  // ================== DOM ==================
  const stage = document.getElementById("stage");
  const center = document.getElementById("center");
  const controls = document.getElementById("controls");
  const toast = document.getElementById("toast");

  const chatBody = document.getElementById("chatBody");
  const courierStatus = document.getElementById("courierStatus");

  const modalOverlay = document.getElementById("modalOverlay");
  const modalBody = document.getElementById("modalBody");
  const modalTitle = document.getElementById("modalTitle");
  const modalSubtitle = document.getElementById("modalSubtitle");

  const finale = document.getElementById("finale");
  const photoRail = document.getElementById("photoRail");
  const photoDots = document.getElementById("photoDots");
  const loveTextEl = document.getElementById("loveText");
  loveTextEl.textContent = LOVE_TEXT;

  const soundBtn = document.getElementById("soundBtn");

  // ================== Helpers ==================
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const q = (sel, root=document) => root.querySelector(sel);

  function showToast(msg, ms=1400){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.classList.remove("show"), ms);
  }

  function vibrate(ms){
    if (navigator.vibrate) navigator.vibrate(ms);
  }

  // ================== –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–≤—É–∫–∏ (WebAudio) ==================
  let audioOn = true;
  let AC = null;
  let master = null;

  function ensureAudio(){
    if (AC) return;
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if (!Ctx) return;
    AC = new Ctx();
    master = AC.createGain();
    master.gain.value = 0.55;
    master.connect(AC.destination);
  }

  function beep({type="sine", freq=440, dur=0.08, vol=0.08, glide=0}){
    if(!audioOn) return;
    ensureAudio();
    if(!AC) return;

    if (AC.state === "suspended") AC.resume().catch(()=>{});

    const o = AC.createOscillator();
    const g = AC.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = 0.0001;

    o.connect(g);
    g.connect(master);

    const t = AC.currentTime;
    g.gain.setValueAtTime(0.0001, t);
    g.gain.exponentialRampToValueAtTime(Math.max(0.0002, vol), t + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t + dur);

    if (glide){
      o.frequency.setValueAtTime(freq, t);
      o.frequency.exponentialRampToValueAtTime(freq * glide, t + dur);
    }

    o.start(t);
    o.stop(t + dur + 0.02);
  }

  function clickSound(){ beep({type:"triangle", freq:520, dur:0.06, vol:0.06, glide:1.03}); }
  function badSound(){ beep({type:"sawtooth", freq:180, dur:0.10, vol:0.06, glide:0.94}); setTimeout(()=>beep({type:"sawtooth", freq:140, dur:0.08, vol:0.05}), 70); }
  function okSound(){ beep({type:"triangle", freq:620, dur:0.07, vol:0.06, glide:1.06}); setTimeout(()=>beep({type:"triangle", freq:820, dur:0.09, vol:0.05}), 70); }
  function unlockSound(){
    beep({type:"square", freq:220, dur:0.06, vol:0.05, glide:1.12});
    setTimeout(()=>beep({type:"triangle", freq:540, dur:0.08, vol:0.06, glide:1.05}), 60);
    setTimeout(()=>beep({type:"sine", freq:880, dur:0.10, vol:0.05, glide:1.02}), 140);
  }

  soundBtn.addEventListener("click", () => {
    audioOn = !audioOn;
    soundBtn.textContent = audioOn ? "üîä –∑–≤—É–∫" : "üîá –∑–≤—É–∫";
    clickSound();
  });

  // Telegram/iOS: –∑–∞–ø—É—Å–∫ –∞—É–¥–∏–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∂–µ—Å—Ç–∞
  window.addEventListener("pointerdown", () => ensureAudio(), {once:true, passive:true});

  // ================== Chat persona ==================
  function typingOn(){
    courierStatus.textContent = "–ø–µ—á–∞—Ç–∞–µ—Ç‚Ä¶";
    const t = document.createElement("div");
    t.className = "typing";
    t.innerHTML = `<span>‚Ä¶</span><span class="dots"><i></i><i></i><i></i></span>`;
    t.dataset.typing = "1";
    chatBody.appendChild(t);
    chatBody.scrollTop = chatBody.scrollHeight;
  }
  function typingOff(){
    courierStatus.textContent = "–Ω–∞ —Å–≤—è–∑–∏";
    const t = chatBody.querySelector('[data-typing="1"]');
    if(t) t.remove();
  }
  async function say(text, {delay=450, tag=""} = {}){
    typingOn();
    await new Promise(r => setTimeout(r, delay));
    typingOff();
    const b = document.createElement("div");
    b.className = "bubble";
    b.innerHTML = text + (tag ? `<div class="tag">${tag}</div>` : "");
    chatBody.appendChild(b);
    chatBody.scrollTop = chatBody.scrollHeight;
    // gentle chat pop sound
    beep({type:"sine", freq:360, dur:0.045, vol:0.03, glide:1.01});
  }
  function clearChat(){
    chatBody.innerHTML = "";
  }

  // ================== FX (hearts/confetti) ==================
  const fx = document.getElementById("fx");
  const fctx = fx.getContext("2d");
  let W=0,H=0, DPR=1;

  function resizeFx(){
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const rect = stage.getBoundingClientRect();
    W = Math.floor(rect.width * DPR);
    H = Math.floor(rect.height * DPR);
    fx.width = W; fx.height = H;
    fx.style.width = rect.width + "px";
    fx.style.height = rect.height + "px";
  }
  window.addEventListener("resize", resizeFx, {passive:true});
  resizeFx();

  const particles = [];
  function spawnHeartsBurst(count=60){
    const rect = stage.getBoundingClientRect();
    const ox = rect.width * .62 * DPR; // slightly towards main pane
    const oy = rect.height * .45 * DPR;
    for(let i=0;i<count;i++){
      particles.push({
        x: ox + (Math.random()-0.5)*50*DPR,
        y: oy + (Math.random()-0.5)*26*DPR,
        vx: (Math.random()-0.5)*6*DPR,
        vy: (-2.2 - Math.random()*5.2)*DPR,
        g: (0.12 + Math.random()*0.10)*DPR,
        rot: Math.random()*Math.PI,
        vr: (Math.random()-0.5)*0.25,
        life: 110 + Math.random()*70,
        kind: Math.random() < 0.65 ? "heart" : "spark",
        s: (10 + Math.random()*14)*DPR,
        a: 1
      });
    }
  }
  function drawHeart(x,y,size,rot,alpha){
    fctx.save();
    fctx.translate(x,y);
    fctx.rotate(rot);
    fctx.globalAlpha = alpha;
    const s=size;
    fctx.beginPath();
    fctx.moveTo(0, s*0.25);
    fctx.bezierCurveTo(s*0.55, -s*0.15, s*0.65, s*0.55, 0, s*0.95);
    fctx.bezierCurveTo(-s*0.65, s*0.55, -s*0.55, -s*0.15, 0, s*0.25);
    fctx.closePath();
    fctx.fillStyle = "rgba(255,77,166,0.95)";
    fctx.fill();
    fctx.globalAlpha = alpha*0.55;
    fctx.fillStyle = "rgba(246,211,107,0.65)";
    fctx.fill();
    fctx.restore();
  }
  function drawSpark(x,y,size,alpha){
    fctx.save();
    fctx.globalAlpha = alpha;
    fctx.beginPath();
    fctx.arc(x,y,size*0.12,0,Math.PI*2);
    fctx.fillStyle = "rgba(255,255,255,0.95)";
    fctx.fill();
    fctx.restore();
  }
  function tickFx(){
    fctx.clearRect(0,0,W,H);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.life -= 1;
      p.a = clamp(p.life/90, 0, 1);

      if(p.kind === "heart") drawHeart(p.x,p.y,p.s,p.rot,p.a);
      else drawSpark(p.x,p.y,p.s,p.a);

      if(p.life <= 0 || p.y > H + 80) particles.splice(i,1);
    }
    requestAnimationFrame(tickFx);
  }
  tickFx();

  // ================== Rotator (physics drag + inertia) ==================
  function makeRotator(wrapEl, objectEl){
    let dragging=false;
    let lastX=0,lastY=0;
    let rx=-12, ry=18;
    let vx=0, vy=0;
    let raf=0;

    const friction = 0.92;
    const speed = 0.18;

    function apply(){
      rx = clamp(rx, -38, 28);
      if (ry > 180) ry -= 360;
      if (ry < -180) ry += 360;
      objectEl.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    }

    function animate(){
      if(!dragging){
        rx += vx;
        ry += vy;
        vx *= friction;
        vy *= friction;
        if(Math.abs(vx) < 0.01) vx = 0;
        if(Math.abs(vy) < 0.01) vy = 0;
        apply();
      }
      raf = requestAnimationFrame(animate);
    }
    raf = requestAnimationFrame(animate);

    function onDown(e){
      dragging = true;
      wrapEl.setPointerCapture?.(e.pointerId);
      lastX = e.clientX;
      lastY = e.clientY;
    }
    function onMove(e){
      if(!dragging) return;
      const dx = e.clientX - lastX;
      const dy = e.clientY - lastY;
      lastX = e.clientX;
      lastY = e.clientY;

      ry += dx * speed;
      rx -= dy * speed;

      vy = dx * speed * 0.35;
      vx = -dy * speed * 0.35;

      apply();
    }
    function onUp(e){
      dragging = false;
      wrapEl.releasePointerCapture?.(e.pointerId);
    }

    wrapEl.addEventListener("pointerdown", onDown);
    wrapEl.addEventListener("pointermove", onMove);
    wrapEl.addEventListener("pointerup", onUp);
    wrapEl.addEventListener("pointercancel", onUp);

    apply();

    return {
      setRotation(x,y){ rx=x; ry=y; apply(); },
      kickShake(){
        vx += (Math.random()-.5)*2.2;
        vy += (Math.random()-.5)*2.2;
      },
      destroy(){
        cancelAnimationFrame(raf);
        wrapEl.removeEventListener("pointerdown", onDown);
        wrapEl.removeEventListener("pointermove", onMove);
        wrapEl.removeEventListener("pointerup", onUp);
        wrapEl.removeEventListener("pointercancel", onUp);
      }
    };
  }

  // ================== Wheels (vertical drum) ==================
  function createWheel(values, initialIndex=0){
    const wheel = document.createElement("div");
    wheel.className = "wheel";
    wheel.innerHTML = `<div class="selector"></div><div class="items"></div>`;
    const items = wheel.querySelector(".items");

    const itemEls = values.map(v => {
      const el = document.createElement("div");
      el.className = "item";
      el.textContent = v;
      items.appendChild(el);
      return el;
    });

    let idx = clamp(initialIndex, 0, values.length-1);
    const rowH = 42;
    let offset = 0;
    let dragging=false;
    let lastY=0;
    let vel=0;

    function update(){
      itemEls.forEach((el,i)=> el.classList.toggle("active", i === idx));
      const targetY = -idx * rowH + offset;
      items.style.transform = `translateY(${targetY}px)`;
    }
    function snap(){
      const raw = idx - offset/rowH;
      idx = Math.round(raw);
      idx = (idx % values.length + values.length) % values.length;
      offset = 0;
      update();
    }
    function onDown(e){
      dragging=true;
      wheel.setPointerCapture?.(e.pointerId);
      lastY = e.clientY;
      vel = 0;
    }
    function onMove(e){
      if(!dragging) return;
      const dy = e.clientY - lastY;
      lastY = e.clientY;
      offset += dy;

      while(offset > rowH){
        offset -= rowH;
        idx = (idx - 1 + values.length) % values.length;
      }
      while(offset < -rowH){
        offset += rowH;
        idx = (idx + 1) % values.length;
      }

      vel = dy;
      update();
    }
    function onUp(e){
      dragging=false;
      wheel.releasePointerCapture?.(e.pointerId);
      const extra = clamp(vel, -18, 18);
      offset += extra;
      snap();
      // tiny wheel sound
      beep({type:"triangle", freq:420, dur:0.03, vol:0.02, glide:1.01});
    }

    wheel.addEventListener("pointerdown", onDown);
    wheel.addEventListener("pointermove", onMove);
    wheel.addEventListener("pointerup", onUp);
    wheel.addEventListener("pointercancel", onUp);

    update();

    return {
      el: wheel,
      getValue(){ return values[idx]; },
      getIndex(){ return idx; },
      setIndex(i){ idx = (i % values.length + values.length) % values.length; offset=0; update(); }
    };
  }

  // ================== Scenes ==================
  let rotator = null;
  let scene = 0;
  let throwDisabled = false;

  function setControls(btns){
    controls.innerHTML = "";
    btns.forEach(b => controls.appendChild(b));
    controls.style.display = btns.length ? "flex" : "none";
  }
  function mount(node){
    center.innerHTML = "";
    center.appendChild(node);
    node.classList.add("fadeIn");
  }
  function openModal(title, subtitle, bodyNode){
    modalTitle.textContent = title;
    modalSubtitle.textContent = subtitle;
    modalBody.innerHTML = "";
    modalBody.appendChild(bodyNode);
    modalOverlay.classList.add("show");
    modalOverlay.setAttribute("aria-hidden", "false");
  }
  function closeModal(){
    modalOverlay.classList.remove("show");
    modalOverlay.setAttribute("aria-hidden", "true");
  }

  // Scene 0: courier + paper
  async function sceneCourier(){
    scene = 0;
    finale.classList.remove("show");
    closeModal();
    setControls([]);
    if(rotator){ rotator.destroy(); rotator=null; }

    clearChat();
    await say("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ üëã<br><strong>–Ø–Ω–¥–µ–∫—Å-–∫—É—Ä—å–µ—Ä</strong>. –£ –≤–∞—Å –ø–æ—Å—ã–ª–∫–∞ <strong>–æ—Ç —Ñ–∞–Ω–∞—Ç–∞</strong>.", {delay: 500});
    await say("–ù—É–∂–Ω–æ —Ä–∞—Å–ø–∏—Å–∞—Ç—å—Å—è. –û—Ç–∫—Ä—ã–≤–∞—é –±—É–º–∞–∂–∫—É‚Ä¶", {delay: 520, tag:"*—à—É—Ä—à–∞–Ω–∏–µ –±—É–º–∞–≥–∏*"});
    clickSound();

    let refusedOnce = false;

    const panel = document.createElement("div");
    panel.className = "panel";
    panel.innerHTML = `
      <h2>[–ø–æ–¥–ø–∏—Å—å_–ø–æ–ª—É—á–∞—Ç–µ–ª—è]</h2>
      <p>–í—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –ø–æ—Å—ã–ª–∫—É –æ—Ç —Ñ–∞–Ω–∞—Ç–∞?</p>
      <div class="row" id="r0"></div>
    `;
    mount(panel);

    const r0 = panel.querySelector("#r0");

    const btnYes = document.createElement("button");
    btnYes.className = "btn primary";
    btnYes.textContent = "‚úÖ –î–∞";

    const btnNo = document.createElement("button");
    btnNo.className = "btn";
    btnNo.textContent = "‚ùå –ù–µ—Ç";

    btnNo.onclick = async () => {
      clickSound();
      panel.classList.add("shake");
      vibrate(40);
      r0.innerHTML = "";
      await say("–í—ã —á—Ç–æ, –±–∞–ª–±–µ—Å? üòë<br>–õ–∞–¥–Ω–æ, –Ω–∞ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –ø—Ä–æ—â–∞—é.", {delay: 480});
      await say("–ü–æ–≤—Ç–æ—Ä—è—é: –ø—Ä–∏–Ω–∏–º–∞–µ–º –ø–æ—Å—ã–ª–∫—É. –ö–Ω–æ–ø–∫—É ¬´–ù–µ—Ç¬ª —è —É–±—Ä–∞–ª.", {delay: 520});
      // re-render only Yes
      r0.appendChild(btnYes);
      refusedOnce = true;
    };

    btnYes.onclick = async () => {
      clickSound();
      await say("–ü–æ–¥–ø–∏—Å—å –ø–æ–ª—É—á–µ–Ω–∞ ‚úÖ", {delay: 420});
      await say("–î–µ—Ä–∂–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É. –û–Ω–∞ <strong>–¥–ª—è –î–∂–∞–º—ã</strong>.", {delay: 520});
      sceneBox();
    };

    r0.appendChild(btnYes);
    r0.appendChild(btnNo);
  }

  // Scene 1: box + lock
  async function sceneBox(){
    scene = 1;
    closeModal();
    finale.classList.remove("show");

    const wrap = document.createElement("div");
    wrap.className = "objectWrap";

    const obj = document.createElement("div");
    obj.className = "object box";
    obj.innerHTML = `
      <div class="boxLabel">–¥–ª—è <span>${GIRL_NAME.toLowerCase()}</span></div>
      <div class="lock" id="lockBtn" title="–ù–∞–∂–º–∏ –Ω–∞ –∑–∞–º–æ–∫">
        <div class="lockGlow"></div>
        <div class="lockIcon"></div>
      </div>
    `;
    wrap.appendChild(obj);
    mount(wrap);

    if(rotator){ rotator.destroy(); }
    rotator = makeRotator(wrap, obj);

    const btnHint = document.createElement("button");
    btnHint.className = "btn";
    btnHint.textContent = "üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞";
    btnHint.onclick = async () => {
      clickSound();
      await say("–°–≤–µ—Ç—è—â–∏–π—Å—è –∑–∞–º–æ–∫ ‚Äî —ç—Ç–æ –Ω–µ –¥–µ–∫–æ—Ä üòâ<br>–ù–∞–∂–º–∏ –Ω–∞ –Ω–µ–≥–æ.", {delay: 420});
      showToast("–ù–∞–∂–º–∏ –Ω–∞ –∑–∞–º–æ–∫ ‚ú®");
    };

    setControls([btnHint]);

    q("#lockBtn", obj).onclick = async () => {
      clickSound();
      await say("–û, –∑–∞–º–æ–∫. –õ—é–±–ª—é –∑–∞–º–∫–∏.", {delay: 420, tag:"*—â–µ–ª–∫*"});
      openLockGame();
    };
  }

  function openLockGame(){
    const days = Array.from({length:31}, (_,i)=> i+1);
    const months = ["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];
    const years = Array.from({length: 50}, (_,i)=> 2000+i);

    const body = document.createElement("div");
    body.innerHTML = `
      <div class="badge">–∫–æ–¥ = –≤–∞–∂–Ω–∞—è –¥–∞—Ç–∞ üíó</div>
      <div class="wheels" id="w"></div>
      <div class="modalActions" id="ma"></div>
    `;

    const w = body.querySelector("#w");

    const wDay = createWheel(days.map(String), BOX_CODE.day-1);
    const wMonth = createWheel(months, BOX_CODE.monthIndex-1);
    const yIndex = years.indexOf(BOX_CODE.year);
    const wYear = createWheel(years.map(String), yIndex >= 0 ? yIndex : 0);

    w.appendChild(wDay.el);
    w.appendChild(wMonth.el);
    w.appendChild(wYear.el);

    const ma = body.querySelector("#ma");

    const back = document.createElement("button");
    back.className = "btn";
    back.textContent = "‚Üê –ù–∞–∑–∞–¥";
    back.onclick = () => { clickSound(); closeModal(); };

    const ok = document.createElement("button");
    ok.className = "btn ok";
    ok.textContent = "–ì–æ—Ç–æ–≤–æ ‚úì";
    ok.onclick = async () => {
      clickSound();
      const day = parseInt(wDay.getValue(),10);
      const month = wMonth.getIndex()+1;
      const year = parseInt(wYear.getValue(),10);

      if(day === BOX_CODE.day && month === BOX_CODE.monthIndex && year === BOX_CODE.year){
        okSound();
        closeModal();
        await say("–ö–æ–¥ –ø–æ–¥–æ—à—ë–ª ‚úÖ", {delay: 420});
        await say("–û—Ç–∫—Ä—ã–≤–∞—é –ø–æ—Å—ã–ª–∫—É‚Ä¶", {delay: 520, tag:"*–º–µ—Ö–∞–Ω–∏–∑–º*"});
        unlockBoxSequence();
      } else {
        badSound();
        vibrate(60);
        showToast("–ù–µ-–∞. –ö–æ–¥ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç üòà");
        say("–ù–µ —Ç–æ. –ü—Ä–æ–±—É–π –µ—â—ë üòâ", {delay: 250});
        const lockEl = q(".lock", center);
        lockEl?.classList.add("shake");
        setTimeout(()=> lockEl?.classList.remove("shake"), 220);
        rotator?.kickShake();
      }
    };

    ma.appendChild(back);
    ma.appendChild(ok);

    openModal("–ó–∞–º–æ–∫ –Ω–∞ –ø–æ—Å—ã–ª–∫–µ", "–î–µ–Ω—å / –º–µ—Å—è—Ü / –≥–æ–¥", body);
  }

  function unlockBoxSequence(){
    unlockSound();
    showToast("–©—ë–ª–∫! –ó–∞–º–æ–∫ –æ—Ç–∫—Ä—ã–ª—Å—è üòå");
    spawnHeartsBurst(46);

    const wrap = document.createElement("div");
    wrap.className = "objectWrap";

    const obj = document.createElement("div");
    obj.className = "object box";
    obj.innerHTML = `
      <div class="boxLabel">–æ—Ç–∫—Ä—ã—Ç–æ ‚úÖ</div>
      <div style="
        position:absolute; left:50%; top:46%;
        transform: translate(-50%,-50%) translateZ(18px);
        width: 250px; height: 160px; border-radius: 18px;
        background: rgba(0,0,0,.22);
        border: 1px solid rgba(255,255,255,.14);
        display:flex; align-items:center; justify-content:center;
        font-weight:900; letter-spacing:.3px;
        font-family: var(--mono);">
        <span style="background:linear-gradient(90deg, var(--pink2), var(--gold));
          -webkit-background-clip:text; background-clip:text; color:transparent;">
          –ø–æ—è–≤–∏–ª—Å—è –∫–æ–Ω–≤–µ—Ä—Ç üíå
        </span>
      </div>
    `;
    wrap.appendChild(obj);
    mount(wrap);

    if(rotator){ rotator.destroy(); }
    rotator = makeRotator(wrap, obj);
    rotator.setRotation(-10, 22);

    const next = document.createElement("button");
    next.className = "btn primary";
    next.textContent = "–í–∑—è—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç ‚Üí";
    next.onclick = async () => {
      clickSound();
      await say("–ê–∫–∫—É—Ä–∞—Ç–Ω–æ. –ö–æ–Ω–≤–µ—Ä—Ç –Ω–µ–∂–Ω—ã–π.", {delay: 420});
      sceneEnvelope();
    };

    setControls([next]);
  }

  // Scene 2: envelope + seal
  function sceneEnvelope(){
    scene = 2;
    closeModal();
    if(rotator){ rotator.destroy(); rotator=null; }
    throwDisabled = false;

    const wrap = document.createElement("div");
    wrap.className = "objectWrap";

    const obj = document.createElement("div");
    obj.className = "object envelope";
    obj.innerHTML = `
      <div class="envTop"></div>
      <div class="seal" id="seal"><span>‚ù§</span></div>
    `;
    wrap.appendChild(obj);
    mount(wrap);

    rotator = makeRotator(wrap, obj);
    rotator.setRotation(-14, 16);

    const btnThrow = document.createElement("button");
    btnThrow.className = "btn danger";
    btnThrow.textContent = "üóëÔ∏è –í—ã–±—Ä–æ—Å–∏—Ç—å";

    const btnOpen = document.createElement("button");
    btnOpen.className = "btn primary";
    btnOpen.textContent = "üíå –û—Ç–∫—Ä—ã—Ç—å";

    btnThrow.onclick = async () => {
      if(throwDisabled) return;
      throwDisabled = true;
      badSound();
      vibrate(70);
      obj.classList.add("shake");
      showToast("–©–∞—Å –ø–æ —à–µ–µ –ø–æ–ª—É—á–∏—à—å");
      await say("–ù–µ-–Ω–µ-–Ω–µ üòê<br>–í—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–µ–ª—å–∑—è.", {delay: 420});
      setTimeout(()=> obj.classList.remove("shake"), 240);

      // animate replace: open wins
      btnOpen.animate([
        { transform: "translateX(0)", opacity: 1 },
        { transform: "translateX(-6px)", opacity: 1 }
      ], { duration: 260, easing: "cubic-bezier(.2,.8,.2,1)" });

      btnThrow.animate([
        { transform: "translateX(0)", opacity: 1 },
        { transform: "translateX(14px)", opacity: 0 }
      ], { duration: 260, easing: "cubic-bezier(.2,.8,.2,1)" }).onfinish = () => {
        setControls([btnOpen]);
      };
    };

    btnOpen.onclick = async () => {
      clickSound();
      await say("–û—Ç–∫—Ä—ã—Ç—å? –¢–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –æ–¥–∏–Ω —Å–µ–∫—Ä–µ—Ç.", {delay: 450});
      openSealPrompt(obj);
    };

    setControls([btnThrow, btnOpen]);
  }

  function openSealPrompt(envelopeEl){
    const body = document.createElement("div");
    body.innerHTML = `
      <div class="badge">–ø–µ—á–∞—Ç—å –¥–µ—Ä–∂–∏—Ç –∫–æ–Ω–≤–µ—Ä—Ç</div>
      <div class="datePrompt">
        <div style="color:var(--muted); font-size:12px; line-height:1.35; font-family: var(--mono);">
          –í–≤–µ–¥–∏—Ç–µ <b>–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è —Ñ–∞–Ω–∞—Ç–∞</b> (–¥–¥.–º–º.–≥–≥–≥–≥)
        </div>
        <div class="field">
          <input id="dateIn" type="text" inputmode="numeric" placeholder="01.02.2005" maxlength="10" />
          <button class="btn ok" id="checkBtn">‚úì</button>
        </div>
        <div class="modalActions">
          <button class="btn" id="backBtn">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
      </div>
    `;

    openModal("–ü–µ—á–∞—Ç—å", "–ë–µ–∑ –¥–∞—Ç—ã –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è üôÇ", body);

    const dateIn = body.querySelector("#dateIn");
    const checkBtn = body.querySelector("#checkBtn");
    const backBtn = body.querySelector("#backBtn");

    dateIn.addEventListener("input", () => {
      let v = dateIn.value.replace(/[^\d]/g,"").slice(0,8);
      if(v.length >= 3) v = v.slice(0,2) + "." + v.slice(2);
      if(v.length >= 6) v = v.slice(0,5) + "." + v.slice(5);
      dateIn.value = v;
    });

    backBtn.onclick = () => { clickSound(); closeModal(); };

    checkBtn.onclick = async () => {
      clickSound();
      const v = dateIn.value.trim();
      const m = v.match(/^(\d{2})\.(\d{2})\.(\d{4})$/);
      if(!m){
        badSound();
        vibrate(40);
        showToast("–§–æ—Ä–º–∞—Ç: 01.02.2005");
        await say("–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã —Ç–∞–∫–æ–π: <strong>–¥–¥.–º–º.–≥–≥–≥–≥</strong>", {delay: 320});
        return;
      }
      const d = parseInt(m[1],10), mo = parseInt(m[2],10), y = parseInt(m[3],10);

      if(d === FAN_BDAY.d && mo === FAN_BDAY.m && y === FAN_BDAY.y){
        okSound();
        closeModal();
        await say("–û–≥–æ‚Ä¶ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.", {delay: 380});
        sealOffAndOpen(envelopeEl);
      } else {
        badSound();
        vibrate(70);
        showToast("–ù–µ —Ç–æ üôÇ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑");
        await say("–ù–µ–∞. –ù–æ —Ç—ã –±–ª–∏–∑–∫–æ üòè", {delay: 320});
        envelopeEl.classList.add("shake");
        setTimeout(()=> envelopeEl.classList.remove("shake"), 220);
        rotator?.kickShake();
      }
    };

    setTimeout(()=> dateIn.focus(), 60);
  }

  function sealOffAndOpen(envelopeEl){
    unlockSound();
    showToast("–ü–µ—á–∞—Ç—å –æ—Ç–ø–∞–ª–∞‚Ä¶ üíó");
    spawnHeartsBurst(60);

    const seal = envelopeEl.querySelector(".seal");
    if(!seal){ showFinale(); return; }

    seal.animate([
      { transform: "translate(-50%,-50%) translateZ(20px) scale(1)", opacity: 1 },
      { transform: "translate(-50%,-65%) translateZ(20px) scale(.88)", opacity: .9 },
      { transform: "translate(-50%,-85%) translateZ(20px) scale(.7)", opacity: 0 }
    ], { duration: 520, easing: "cubic-bezier(.2,.8,.2,1)" }).onfinish = async () => {
      seal.remove();
      spawnHeartsBurst(120);
      setTimeout(()=> spawnHeartsBurst(95), 220);
      await say("–ù—É –≤—Å—ë. –°–º–æ—Ç—Ä–∏ —á—Ç–æ –≤–Ω—É—Ç—Ä–∏‚Ä¶", {delay: 450});
      setTimeout(() => showFinale(), 520);
    };
  }

  // ================== Finale ==================
  let photoIndex = 0;
  let photoTimer = null;
  loveTextEl.textContent = LOVE_TEXT;

  function showFinale(){
    center.innerHTML = "";
    setControls([]);
    finale.classList.add("show");

    photoRail.innerHTML = "";
    photoDots.innerHTML = "";

    const files = PHOTO_FILES.slice(0,4);
    const good = [];
    let pending = files.length;

    function done(){
      pending--;
      if(pending > 0) return;

      if(good.length === 0){
        const ph = document.createElement("div");
        ph.style.cssText = "width:100%;height:100%;display:grid;place-items:center;color:rgba(255,255,255,.75);font-family:var(--mono);";
        ph.textContent = "–î–æ–±–∞–≤—å —Ñ–æ—Ç–æ –≤ –ø–∞–ø–∫—É Images üôÇ";
        photoRail.appendChild(ph);
      } else {
        good.forEach((src) => {
          const img = new Image();
          img.src = src;
          img.alt = "photo";
          photoRail.appendChild(img);
        });

        good.forEach((_,i)=>{
          const b = document.createElement("button");
          b.onclick = () => { setPhoto(i, true); clickSound(); };
          photoDots.appendChild(b);
        });

        setPhoto(0, false);

        clearInterval(photoTimer);
        photoTimer = setInterval(() => setPhoto((photoIndex+1) % good.length, false), 3300);
      }

      spawnHeartsBurst(150);
      okSound();
      showToast("–° –¥–Ω—ë–º –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö üíó");
      say("–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ. –°—á–∞—Å—Ç—å—è –≤–∞–º –¥–≤–æ–∏–º üôÇ", {delay: 450, tag:"*–∫–æ–Ω–µ—Ü –¥–æ—Å—Ç–∞–≤–∫–∏*"});
    }

    if(files.length === 0){
      pending = 1;
      done();
      return;
    }

    files.forEach(src=>{
      const img = new Image();
      img.onload = () => { good.push(src); done(); };
      img.onerror = () => { done(); };
      img.src = src;
    });
  }

  function setPhoto(i, manual){
    photoIndex = i;
    photoRail.style.transform = `translateX(${-i * 100}%)`;
    Array.from(photoDots.children).forEach((d,idx)=> d.classList.toggle("active", idx===i));
    if(manual){
      clearInterval(photoTimer);
      photoTimer = null;
    }
  }

  // ================== Boot ==================
  // global gentle click: only for buttons inside controls/panels
  document.addEventListener("click", (e)=>{
    if(e.target.closest("button")) {
      // already plays in handlers mostly, but keep as fallback super-soft
      beep({type:"sine", freq:340, dur:0.03, vol:0.015});
    }
  }, {passive:true});

  sceneCourier();
})();
</script>
</body>
</html>
