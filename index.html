<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title>–î–ª—è –î–∂–∞–º—ã üíå</title>
  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#140b24;
      --card: rgba(255,255,255,.10);
      --card2: rgba(255,255,255,.14);
      --stroke: rgba(255,255,255,.18);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --accent:#ff4fa6;
      --accent2:#7cf1ff;
      --good:#5cffb3;
      --bad:#ff5c7a;
      --shadow: 0 18px 60px rgba(0,0,0,.40);
      --radius: 22px;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 900px at 20% 10%, rgba(255,79,166,.22), transparent 60%),
        radial-gradient(1000px 700px at 80% 20%, rgba(124,241,255,.16), transparent 55%),
        radial-gradient(900px 600px at 60% 90%, rgba(92,255,179,.10), transparent 55%),
        linear-gradient(145deg, var(--bg1), var(--bg2));
    }

    .app{
      position:relative;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: max(16px, env(safe-area-inset-top)) 16px max(16px, env(safe-area-inset-bottom));
    }

    /* –º—è–≥–∫–∞—è ¬´–ø–ª—ë–Ω–∫–∞¬ª */
    .grain::before{
      content:"";
      position:absolute; inset:0;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.20;
      pointer-events:none;
    }

    .stage{
      width:min(980px, 100%);
      height:min(720px, calc(100vh - 24px));
      position:relative;
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .topbar{
      position:absolute; inset: 14px 14px auto 14px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      z-index:20;
      pointer-events:none;
    }
    .badge{
      pointer-events:none;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size:13px;
      letter-spacing:.2px;
      color: rgba(255,255,255,.78);
    }

    .hint{
      pointer-events:none;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size:13px;
      color: rgba(255,255,255,.80);
      display:flex; align-items:center; gap:8px;
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, var(--accent));
      box-shadow: 0 0 18px rgba(255,79,166,.55);
    }

    .scene{
      position:absolute; inset:0;
      display:none;
      z-index:1;
    }
    .scene.active{ display:block; }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏/–¥–∏–∞–ª–æ–≥–∏ */
    .panel{
      position:absolute;
      left:18px; right:18px; bottom:18px;
      padding:16px;
      border-radius: var(--radius);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      z-index:10;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .msg{
      font-size: 16px;
      line-height: 1.35;
      color: rgba(255,255,255,.90);
      margin:0 0 12px 0;
    }
    .submsg{
      font-size: 13px;
      color: rgba(255,255,255,.70);
      margin:0 0 10px 0;
    }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      appearance:none;
      border:0;
      cursor:pointer;
      color: rgba(255,255,255,.92);
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform .12s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
      font-weight: 650;
      letter-spacing: .2px;
      min-width: 110px;
      touch-action: manipulation;
    }
    button:hover{ transform: translateY(-1px); }
    button:active{ transform: translateY(1px) scale(.99); }
    button.primary{
      background: linear-gradient(135deg, rgba(255,79,166,.36), rgba(124,241,255,.22));
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 14px 40px rgba(255,79,166,.14);
    }
    button.danger{
      background: rgba(255,92,122,.14);
      border-color: rgba(255,92,122,.22);
    }
    button.ghost{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.12);
      color: rgba(255,255,255,.82);
    }
    button[disabled]{ opacity:.45; cursor:not-allowed; }

    /* –¶–µ–Ω—Ç—Ä —Å—Ü–µ–Ω—ã */
    .center{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* 3D-–æ–±—ä–µ–∫—Ç */
    .object-wrap{
      width:min(520px, 88vw);
      height:min(420px, 52vh);
      display:flex;
      align-items:center;
      justify-content:center;
      perspective: 1200px;
      touch-action:none;
      user-select:none;
    }
    .object{
      width: min(420px, 80vw);
      height: min(320px, 42vh);
      position:relative;
      transform-style: preserve-3d;
      transform: rotateX(var(--rx, -12deg)) rotateY(var(--ry, 20deg));
      transition: filter .25s ease;
      will-change: transform;
    }

    /* –ö–æ—Ä–æ–±–∫–∞ */
    .box{
      position:absolute; inset:0;
      border-radius: 24px;
      background:
        radial-gradient(120px 120px at 30% 20%, rgba(255,255,255,.14), transparent 60%),
        linear-gradient(145deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 24px 70px rgba(0,0,0,.40);
      overflow:hidden;
    }
    .box::after{
      content:"";
      position:absolute; inset: -1px;
      background:
        linear-gradient(90deg, rgba(255,79,166,.18), transparent 35%, rgba(124,241,255,.16));
      opacity:.9;
      mix-blend-mode: soft-light;
      pointer-events:none;
    }
    .label{
      position:absolute;
      left: 18px; top: 18px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.14);
      font-weight: 750;
      letter-spacing:.3px;
    }
    .ribbon{
      position:absolute;
      left: 50%;
      top: -8%;
      width: 20%;
      height: 116%;
      transform: translateX(-50%);
      background: linear-gradient(180deg, rgba(255,79,166,.35), rgba(255,79,166,.10));
      border-left: 1px solid rgba(255,255,255,.12);
      border-right: 1px solid rgba(255,255,255,.12);
      filter: drop-shadow(0 10px 30px rgba(255,79,166,.14));
    }
    .ribbon::before{
      content:"";
      position:absolute;
      left:-120%;
      top: 26%;
      width: 340%;
      height: 16%;
      transform: rotate(-14deg);
      background: linear-gradient(90deg, rgba(255,79,166,.34), rgba(124,241,255,.16));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 999px;
      opacity:.85;
    }

    .lock{
      position:absolute;
      right: 18px; bottom: 18px;
      width: 96px; height: 96px;
      border-radius: 22px;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.16);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      transform: translateZ(26px);
      box-shadow: 0 16px 50px rgba(0,0,0,.32);
      overflow:hidden;
    }
    .lock::before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,79,166,.42), transparent 55%),
                  radial-gradient(circle at 70% 70%, rgba(124,241,255,.30), transparent 55%);
      animation: glow 1.8s ease-in-out infinite;
      filter: blur(8px);
      opacity:.9;
    }
    .lock svg{ position:relative; z-index:2; filter: drop-shadow(0 6px 16px rgba(255,79,166,.18)); }
    @keyframes glow{
      0%,100%{ transform: translate(-2%, -2%) scale(1.05); opacity:.75; }
      50%{ transform: translate(2%, 2%) scale(1.12); opacity:1; }
    }

    /* –ö–æ–Ω–≤–µ—Ä—Ç */
    .envelope{
      position:absolute; inset:0;
      border-radius: 24px;
      background:
        linear-gradient(145deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 24px 70px rgba(0,0,0,.40);
      overflow:hidden;
    }
    .flap{
      position:absolute;
      left: 0; right: 0; top: 0;
      height: 58%;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      clip-path: polygon(0 0, 100% 0, 50% 70%);
      opacity:.95;
      transform: translateZ(12px);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .seal{
      position:absolute;
      left:50%; top:52%;
      transform: translate(-50%,-50%) translateZ(28px);
      width: 86px; height: 86px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.35), rgba(255,79,166,.85));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 18px 60px rgba(255,79,166,.18), inset 0 0 0 8px rgba(0,0,0,.06);
      display:flex; align-items:center; justify-content:center;
      font-weight: 900;
      letter-spacing:.6px;
      text-transform: uppercase;
      color: rgba(255,255,255,.95);
      cursor:pointer;
      user-select:none;
    }
    .seal small{ opacity:.9; font-size: 12px; }

    .shake{
      animation: shake .22s ease-in-out 0s 2;
    }
    @keyframes shake{
      0%{ transform: translate(-50%,-50%) translateZ(28px) rotate(0deg); }
      25%{ transform: translate(calc(-50% + 2px), -50%) translateZ(28px) rotate(1deg); }
      50%{ transform: translate(-50%, calc(-50% + 2px)) translateZ(28px) rotate(-1deg); }
      75%{ transform: translate(calc(-50% - 2px), -50%) translateZ(28px) rotate(1deg); }
      100%{ transform: translate(-50%,-50%) translateZ(28px) rotate(0deg); }
    }

    /* –ú–æ–¥–∞–ª–∫–∏ */
    .overlay{
      position:absolute; inset:0;
      background: rgba(0,0,0,.34);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:none;
      z-index:30;
    }
    .overlay.active{ display:block; }

    .modal{
      position:absolute;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%);
      width: min(720px, calc(100% - 28px));
      border-radius: 26px;
      background: rgba(10,12,20,.70);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 24px 70px rgba(0,0,0,.55);
      padding: 16px;
      overflow:hidden;
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      margin-bottom: 12px;
    }
    .title{
      font-size: 16px;
      font-weight: 850;
      letter-spacing:.25px;
      margin:0;
    }
    .subtitle{
      margin:4px 0 0 0;
      font-size: 13px;
      color: rgba(255,255,255,.70);
    }

    /* –ü–∏–∫–µ—Ä –∑–∞–º–∫–∞ (3 –∫–æ–ª–æ–Ω–∫–∏) */
    .picker-wrap{
      display:grid;
      grid-template-columns: 1fr 1.2fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .picker{
      height: 220px;
      border-radius: 20px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      position:relative;
      touch-action:none;
    }
    .picker::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.55), transparent 30%, transparent 70%, rgba(0,0,0,.55));
      pointer-events:none;
      z-index:2;
    }
    .picker::after{
      content:"";
      position:absolute;
      left: 10px; right: 10px;
      top: 50%;
      height: 48px;
      transform: translateY(-50%);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      pointer-events:none;
      z-index:2;
    }
    .wheel{
      position:absolute;
      left:0; right:0;
      top: 50%;
      transform: translateY(-50%);
      will-change: transform;
      z-index:1;
    }
    .item{
      height: 48px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 850;
      letter-spacing:.2px;
      color: rgba(255,255,255,.78);
      opacity:.85;
      user-select:none;
    }
    .item.active{
      color: rgba(255,255,255,.96);
      opacity:1;
      text-shadow: 0 10px 30px rgba(255,255,255,.10);
    }

    /* –ò–Ω–ø—É—Ç –¥–∞—Ç—ã (–¥–ª—è –ø–µ—á–∞—Ç–∏) */
    .date-row{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      margin-top: 10px;
    }
    .field{
      flex:1 1 240px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .field input{
      width:100%;
      background: transparent;
      border:0;
      outline:none;
      color: rgba(255,255,255,.92);
      font-size: 16px;
      letter-spacing:.6px;
      font-weight: 800;
    }
    .field input::placeholder{ color: rgba(255,255,255,.45); }

    /* –§–µ–π–µ—Ä–≤–µ—Ä–∫–∏/—Å–µ—Ä–¥–µ—á–∫–∏ */
    canvas#fx{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:25;
    }

    /* –§–æ—Ç–æ-–≥–∞–ª–µ—Ä–µ—è */
    .gallery{
      position:absolute;
      left: 18px; right: 18px;
      top: 64px;
      display:flex;
      gap: 12px;
      justify-content:center;
      flex-wrap:wrap;
      z-index:12;
      pointer-events:none;
      opacity:0;
      transform: translateY(8px);
      transition: opacity .6s ease, transform .6s ease;
    }
    .gallery.show{ opacity:1; transform: translateY(0); }
    .photo{
      width: min(220px, 28vw);
      aspect-ratio: 4/5;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      overflow:hidden;
      position:relative;
    }
    .photo img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.04);
      filter: saturate(1.05) contrast(1.02);
    }
    .photo::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(220px 180px at 20% 20%, rgba(255,255,255,.18), transparent 60%);
      pointer-events:none;
      mix-blend-mode: soft-light;
    }

    /* –ë—É–º–∞–∂–∫–∞ –∏–∑ —Ç–µ—Ç—Ä–∞–¥–∫–∏ */
    .note{
      position:absolute;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%) scale(.98);
      width: min(720px, calc(100% - 34px));
      max-height: calc(100% - 140px);
      overflow:auto;
      opacity:0;
      z-index:14;
      border-radius: 22px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.88));
      color: #182033;
      box-shadow: 0 24px 80px rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.25);
      padding: 18px 18px 20px;
      transition: opacity .7s ease, transform .7s ease;
    }
    .note.show{ opacity:1; transform: translate(-50%,-50%) scale(1); }
    .paper{
      position:relative;
      border-radius: 16px;
      padding: 18px 18px 22px;
      background:
        repeating-linear-gradient(180deg,
          rgba(24,32,51,.09) 0px, rgba(24,32,51,.09) 1px,
          transparent 1px, transparent 26px);
    }
    .paper::before{
      content:"";
      position:absolute; left: 54px; top:0; bottom:0;
      width: 2px;
      background: rgba(255,79,166,.35);
    }
    .paper h2{
      margin: 0 0 10px 0;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .paper p{
      margin: 0;
      font-size: 16px;
      line-height: 1.55;
      letter-spacing:.1px;
      white-space: pre-wrap;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ */
    .fadeIn{ animation: fadeIn .45s ease both; }
    .fadeOut{ animation: fadeOut .35s ease both; }
    @keyframes fadeIn{ from{opacity:0; transform: translateY(8px);} to{opacity:1; transform: translateY(0);} }
    @keyframes fadeOut{ from{opacity:1;} to{opacity:0;} }

    /* –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–æ–±–∫–∏/–∫–æ–Ω–≤–µ—Ä—Ç–∞ */
    .openBox{
      animation: openBox 1.05s cubic-bezier(.2,.9,.2,1) both;
      transform-origin: center;
    }
    @keyframes openBox{
      0%{ filter: brightness(1); transform: translateZ(0) scale(1) rotateX(var(--rx)) rotateY(var(--ry)); }
      45%{ filter: brightness(1.12); transform: translateZ(0) scale(1.02) rotateX(calc(var(--rx) - 4deg)) rotateY(calc(var(--ry) + 12deg)); }
      100%{ filter: brightness(1.18); transform: translateZ(0) scale(1.04) rotateX(calc(var(--rx) - 10deg)) rotateY(calc(var(--ry) + 28deg)); }
    }

    .sealDrop{
      animation: sealDrop .7s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes sealDrop{
      0%{ transform: translate(-50%,-50%) translateZ(28px) rotate(0deg); opacity:1; }
      70%{ transform: translate(-50%, calc(-50% + 160px)) translateZ(12px) rotate(16deg); opacity:1; }
      100%{ transform: translate(-50%, calc(-50% + 220px)) translateZ(0px) rotate(26deg); opacity:0; }
    }

    .zoomToSeal{
      animation: zoomToSeal .55s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes zoomToSeal{
      0%{ transform: rotateX(var(--rx)) rotateY(var(--ry)) scale(1); }
      100%{ transform: rotateX(calc(var(--rx) - 6deg)) rotateY(calc(var(--ry) + 10deg)) scale(1.10); }
    }

    /* –º–∞–ª–µ–Ω—å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    .toast{
      position:absolute;
      left: 50%; bottom: 98px;
      transform: translateX(-50%);
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 16px 50px rgba(0,0,0,.35);
      opacity:0;
      pointer-events:none;
      z-index:40;
      transition: opacity .25s ease, transform .25s ease;
      font-weight: 750;
      color: rgba(255,255,255,.92);
      max-width: calc(100% - 34px);
      text-align:center;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-6px);
    }

    /* –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 520px){
      .msg{ font-size: 15px; }
      button{ min-width: 104px; padding: 12px 12px; }
      .picker-wrap{ grid-template-columns: 1fr; }
      .picker{ height: 200px; }
      .photo{ width: 42vw; }
    }
  </style>
</head>

<body>
  <div class="app grain">
    <div class="stage" id="stage">
      <div class="topbar">
        <div class="badge" id="badge">–î–ª—è –î–∂–∞–º—ã ‚Ä¢ –º–∏–Ω–∏-–∏–≥—Ä–∞</div>
        <div class="hint" id="hint"><span class="dot"></span><span id="hintText">–õ–∏—Å—Ç–∞–π –¥–∞–ª—å—à–µ üòå</span></div>
      </div>

      <canvas id="fx"></canvas>

      <!-- –°–¶–ï–ù–ê 1 -->
      <section class="scene active" id="scene1" aria-label="–ö—É—Ä—å–µ—Ä">
        <div class="center">
          <div class="object-wrap" id="courierWrap">
            <div class="object" id="courierObj">
              <div class="box" style="display:flex;align-items:center;justify-content:center;">
                <div style="text-align:center;padding:18px;">
                  <div style="font-size:46px;filter:drop-shadow(0 16px 40px rgba(0,0,0,.25));">üßç‚Äç‚ôÇÔ∏èüì¶</div>
                  <div style="margin-top:8px;font-weight:900;letter-spacing:.25px;">–Ø–Ω–¥–µ–∫—Å-–∫—É—Ä—å–µ—Ä</div>
                  <div style="margin-top:6px;color:rgba(255,255,255,.72);font-size:13px;">
                    ¬´–í–∞–º –ø–æ—Å—ã–ª–∫–∞ –æ—Ç —Ñ–∞–Ω–∞—Ç–∞¬ª
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel" id="paperPanel">
          <p class="msg" id="paperMsg">–í—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –ø–æ—Å—ã–ª–∫—É –æ—Ç —Ñ–∞–Ω–∞—Ç–∞?</p>
          <p class="submsg" id="paperSub">–ù—É–∂–Ω–æ —Ä–∞—Å–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±—É–º–∞–∂–∫–µ.</p>
          <div class="row">
            <div class="btns" id="paperBtns">
              <button class="primary" id="btnYes1">–î–∞</button>
              <button class="ghost" id="btnNo1">–ù–µ—Ç</button>
            </div>
            <div style="font-size:12px;color:rgba(255,255,255,.62);">–∫–∞—Å–∞–Ω–∏–µ/–º—ã—à—å: –º–æ–∂–Ω–æ –∫—Ä—É—Ç–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
          </div>
        </div>
      </section>

      <!-- –°–¶–ï–ù–ê 2 -->
      <section class="scene" id="scene2" aria-label="–ö–æ—Ä–æ–±–∫–∞">
        <div class="center">
          <div class="object-wrap" id="boxWrap">
            <div class="object" id="boxObj">
              <div class="box">
                <div class="ribbon"></div>
                <div class="label">–î–ª—è –î–∂–∞–º—ã</div>
                <div class="lock" id="lockBtn" title="–ù–∞–∂–º–∏ –Ω–∞ –∑–∞–º–æ–∫">
                  <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="white" stroke-opacity=".92" stroke-width="1.8" stroke-linecap="round"/>
                    <path d="M7.6 11h8.8a2.6 2.6 0 0 1 2.6 2.6v4.8A2.6 2.6 0 0 1 16.4 21H7.6A2.6 2.6 0 0 1 5 18.4v-4.8A2.6 2.6 0 0 1 7.6 11Z" stroke="white" stroke-opacity=".92" stroke-width="1.8" />
                    <path d="M12 14.2v3.2" stroke="white" stroke-opacity=".92" stroke-width="1.8" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <p class="msg">–ü–æ—Å—ã–ª–∫–∞ –∑–∞–ø–µ—Ä—Ç–∞. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π –∑–∞–º–æ–∫.</p>
          <p class="submsg">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–æ–¥ ‚Äî –¥–∞—Ç–∞ <b>5 –Ω–æ—è–±—Ä—è 2025</b>.</p>
          <div class="row">
            <div class="btns">
              <button class="ghost" id="backTo1">–ù–∞–∑–∞–¥</button>
            </div>
            <div style="font-size:12px;color:rgba(255,255,255,.62);">–∫—Ä—É—Ç–∏ –∫–æ—Ä–æ–±–∫—É –ø–∞–ª—å—Ü–µ–º ‚Äî –æ–Ω–∞ ¬´–∏–Ω–µ—Ä—Ü–∏–æ–Ω–Ω–∞—è¬ª</div>
          </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–º–∫–∞ -->
        <div class="overlay" id="lockOverlay">
          <div class="modal">
            <div class="modal-head">
              <div>
                <h3 class="title">–ö–æ–¥–æ–≤—ã–π –∑–∞–º–æ–∫</h3>
                <p class="subtitle">–ü—Ä–æ–∫—Ä—É—Ç–∏ –∫–æ–ª—ë—Å–∏–∫–∏ –∏ –Ω–∞–∂–º–∏ ¬´–ì–æ—Ç–æ–≤–æ¬ª</p>
              </div>
              <div style="font-size:12px;color:rgba(255,255,255,.65);">–¥–µ–Ω—å ‚Ä¢ –º–µ—Å—è—Ü ‚Ä¢ –≥–æ–¥</div>
            </div>

            <div class="picker-wrap">
              <div class="picker" id="pickerDay"></div>
              <div class="picker" id="pickerMonth"></div>
              <div class="picker" id="pickerYear"></div>
            </div>

            <div class="row" style="margin-top:14px;">
              <div class="btns">
                <button class="ghost" id="lockBack">–ù–∞–∑–∞–¥</button>
              </div>
              <div class="btns">
                <button class="primary" id="lockDone">–ì–æ—Ç–æ–≤–æ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- –°–¶–ï–ù–ê 3 -->
      <section class="scene" id="scene3" aria-label="–ö–æ–Ω–≤–µ—Ä—Ç">
        <div class="center">
          <div class="object-wrap" id="envWrap">
            <div class="object" id="envObj">
              <div class="envelope">
                <div class="flap"></div>
                <div class="seal" id="sealBtn"><span>F</span><small style="margin-left:6px;">‚ù§</small></div>
              </div>
            </div>
          </div>
        </div>

        <div class="gallery" id="gallery"></div>

        <div class="note" id="note">
          <div class="paper">
            <h2>–î–∂–∞–º–∞ üíó</h2>
            <p id="loveText">
–Ø –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ —Ç—ã —ç—Ç–æ –¥–µ–ª–∞–µ—à—å,
–Ω–æ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–∏—à–µ ‚Äî –∏ —Ç–µ–ø–ª–µ–µ.

–¢—ã –º–æ—è –ª—é–±–∏–º–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é —è —Ö–æ—á—É –≤—ã–±–∏—Ä–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.

–° –î–Ω—ë–º —Å–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞.
–¢–≤–æ–π —Ñ–∞–Ω–∞—Ç :)
            </p>
          </div>
        </div>

        <div class="panel" id="envPanel">
          <p class="msg" id="envMsg">–í–Ω—É—Ç—Ä–∏ ‚Äî –ø–∏—Å—å–º–æ. –ù–æ –ø–µ—á–∞—Ç—å –º–µ—à–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç.</p>
          <p class="submsg" id="envSub">–ú–æ–∂–Ω–æ –∫—Ä—É—Ç–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç. –ü–µ—á–∞—Ç—å –≤—ã–≥–ª—è–¥–∏—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω–æ–π.</p>
          <div class="row">
            <div class="btns" id="envBtns">
              <button class="danger" id="throwBtn">–í—ã–±—Ä–æ—Å–∏—Ç—å</button>
              <button class="primary" id="openBtn">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
            <div style="font-size:12px;color:rgba(255,255,255,.62);">–∫—Ä—É—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç –ø–∞–ª—å—Ü–µ–º</div>
          </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è -->
        <div class="overlay" id="bdayOverlay">
          <div class="modal">
            <div class="modal-head">
              <div>
                <h3 class="title">–ü–µ—á–∞—Ç—å –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ ¬´—Å–µ–∫—Ä–µ—Ç–µ¬ª</h3>
                <p class="subtitle">–í–≤–µ–¥–∏ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è —Ñ–∞–Ω–∞—Ç–∞</p>
              </div>
            </div>

            <div class="date-row">
              <div class="field">
                <span style="opacity:.8">üìÖ</span>
                <input id="bdayInput" inputmode="numeric" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" maxlength="10" />
              </div>
              <button class="primary" id="bdayOk" style="min-width:90px;">‚úì</button>
              <button class="ghost" id="bdayClose" style="min-width:110px;">–ù–∞–∑–∞–¥</button>
            </div>

            <p class="subtitle" style="margin-top:10px;opacity:.8;">
              –ü–æ–¥—Å–∫–∞–∑–∫–∞: <b>01.02.2005</b>
            </p>
          </div>
        </div>

      </section>

      <div class="toast" id="toast"></div>
    </div>
  </div>

  <script>
    // ----------------------------
    // –£—Ç–∏–ª–∏—Ç—ã
    // ----------------------------
    const $ = (s, el=document) => el.querySelector(s);
    const clamp = (v,a,b) => Math.max(a, Math.min(b,v));
    const lerp = (a,b,t) => a + (b-a)*t;

    const toast = $("#toast");
    let toastTimer = null;
    function showToast(text, ms=1400){
      toast.textContent = text;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toast.classList.remove("show"), ms);
    }

    function setHint(text){
      $("#hintText").textContent = text;
    }

    // ----------------------------
    // –§–∏–∑–∏—á–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (—Å –∏–Ω–µ—Ä—Ü–∏–µ–π)
    // ----------------------------
    function attachInertiaRotation(wrapEl, objEl, opt={}){
      const state = {
        rx: opt.rx ?? -12,
        ry: opt.ry ?? 20,
        vx: 0, vy: 0,
        dragging:false,
        lastX:0, lastY:0,
        lastT:0
      };

      function apply(){
        objEl.style.setProperty("--rx", state.rx + "deg");
        objEl.style.setProperty("--ry", state.ry + "deg");
      }
      apply();

      const friction = opt.friction ?? 0.92;
      const speed = opt.speed ?? 0.16;
      const maxX = opt.maxX ?? 26;

      function onDown(e){
        state.dragging = true;
        const p = getPoint(e);
        state.lastX = p.x; state.lastY = p.y;
        state.lastT = performance.now();
        state.vx = 0; state.vy = 0;
        wrapEl.setPointerCapture?.(e.pointerId);
      }

      function onMove(e){
        if(!state.dragging) return;
        const p = getPoint(e);
        const now = performance.now();
        const dt = Math.max(16, now - state.lastT);

        const dx = (p.x - state.lastX);
        const dy = (p.y - state.lastY);

        // –≤–µ—Ä—Ç–∏–∫–∞–ª—å -> rotateX, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å -> rotateY
        state.ry += dx * speed;
        state.rx -= dy * speed;
        state.rx = clamp(state.rx, -maxX, maxX);

        // —Å–∫–æ—Ä–æ—Å—Ç—å (–¥–ª—è –∏–Ω–µ—Ä—Ü–∏–∏)
        state.vy = (dx / dt) * 18;
        state.vx = (-dy / dt) * 18;

        state.lastX = p.x; state.lastY = p.y; state.lastT = now;
        apply();
      }

      function onUp(e){
        state.dragging = false;
      }

      function tick(){
        if(!state.dragging){
          state.vx *= friction;
          state.vy *= friction;
          if(Math.abs(state.vx) < 0.02) state.vx = 0;
          if(Math.abs(state.vy) < 0.02) state.vy = 0;

          state.rx += state.vx;
          state.ry += state.vy;
          state.rx = clamp(state.rx, -maxX, maxX);
          apply();
        }
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);

      function getPoint(e){
        if(e.touches && e.touches[0]) return {x:e.touches[0].clientX, y:e.touches[0].clientY};
        return {x:e.clientX, y:e.clientY};
      }

      // pointer events
      wrapEl.addEventListener("pointerdown", onDown, {passive:true});
      wrapEl.addEventListener("pointermove", onMove, {passive:true});
      wrapEl.addEventListener("pointerup", onUp, {passive:true});
      wrapEl.addEventListener("pointercancel", onUp, {passive:true});
    }

    // ----------------------------
    // Wheel picker (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π)
    // ----------------------------
    function createWheelPicker(container, items, initialIndex=0){
      container.innerHTML = "";
      const wheel = document.createElement("div");
      wheel.className = "wheel";
      container.appendChild(wheel);

      const itemEls = items.map((t)=>{
        const d = document.createElement("div");
        d.className = "item";
        d.textContent = t;
        wheel.appendChild(d);
        return d;
      });

      const itemH = 48;
      const state = {
        index: clamp(initialIndex, 0, items.length-1),
        offset: 0, // px relative to center position
        v: 0,
        dragging:false,
        lastY:0,
        lastT:0
      };

      function syncActive(){
        itemEls.forEach((el,i)=> el.classList.toggle("active", i===state.index));
      }

      function setIndex(i){
        state.index = clamp(i, 0, items.length-1);
        state.offset = 0;
        state.v = 0;
        render();
      }

      function render(){
        // wheel centered: index at center
        const base = -state.index * itemH + state.offset;
        wheel.style.transform = `translateY(calc(-50% + ${base}px))`;
        // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ
        syncActive();
      }

      function snap(){
        // offset -> nearest item
        const deltaIndex = Math.round(-state.offset / itemH);
        state.index = clamp(state.index + deltaIndex, 0, items.length-1);
        state.offset = 0;
        render();
      }

      function onDown(e){
        state.dragging = true;
        state.lastY = getY(e);
        state.lastT = performance.now();
        state.v = 0;
        container.setPointerCapture?.(e.pointerId);
      }

      function onMove(e){
        if(!state.dragging) return;
        const y = getY(e);
        const now = performance.now();
        const dt = Math.max(16, now - state.lastT);
        const dy = y - state.lastY;

        state.offset += dy;
        // –æ–≥—Ä–∞–Ω–∏—á–∏–º offset, –Ω–æ –º—è–≥–∫–æ
        const maxOffset = itemH * 2.2;
        state.offset = clamp(state.offset, -maxOffset, maxOffset);

        state.v = (dy / dt) * 26;
        state.lastY = y;
        state.lastT = now;
        render();
      }

      function onUp(){
        state.dragging = false;
        snap();
      }

      function tick(){
        if(!state.dragging){
          state.v *= 0.86;
          if(Math.abs(state.v) < 0.08) state.v = 0;
          if(state.v !== 0){
            state.offset += state.v;
            const maxOffset = itemH * 2.2;
            state.offset = clamp(state.offset, -maxOffset, maxOffset);
            render();
          }
        }
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);

      function getY(e){
        if(e.touches && e.touches[0]) return e.touches[0].clientY;
        return e.clientY;
      }

      container.addEventListener("pointerdown", onDown, {passive:true});
      container.addEventListener("pointermove", onMove, {passive:true});
      container.addEventListener("pointerup", onUp, {passive:true});
      container.addEventListener("pointercancel", onUp, {passive:true});

      render();

      return {
        get value(){ return items[state.index]; },
        get index(){ return state.index; },
        setIndex
      };
    }

    // ----------------------------
    // FX: —Å–µ—Ä–¥—Ü–∞/—Ñ–µ–π–µ—Ä–≤–µ—Ä–∫
    // ----------------------------
    const fx = $("#fx");
    const ctx = fx.getContext("2d");
    let W=0,H=0, DPR=1;
    function resizeFx(){
      DPR = Math.min(2, window.devicePixelRatio || 1);
      const rect = fx.getBoundingClientRect();
      W = Math.floor(rect.width);
      H = Math.floor(rect.height);
      fx.width = Math.floor(W * DPR);
      fx.height = Math.floor(H * DPR);
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener("resize", resizeFx, {passive:true});

    const particles = [];
    function spawnHeartsBurst(count=26){
      for(let i=0;i<count;i++){
        const x = W*0.5 + (Math.random()-0.5)*120;
        const y = H*0.52 + (Math.random()-0.5)*80;
        particles.push(makeParticle(x,y, "heart"));
      }
    }
    function spawnFirework(count=34){
      for(let i=0;i<count;i++){
        const x = W*0.5 + (Math.random()-0.5)*180;
        const y = H*0.38 + (Math.random()-0.5)*120;
        particles.push(makeParticle(x,y, "spark"));
      }
    }
    function makeParticle(x,y,type){
      const a = Math.random()*Math.PI*2;
      const s = (type==="spark" ? 3.6 : 2.8) + Math.random()*3.0;
      return {
        type,
        x,y,
        vx: Math.cos(a)*s,
        vy: Math.sin(a)*s - (type==="heart" ? 1.2 : 0.2),
        life: 1,
        size: (type==="spark" ? 2.2 : 10) + Math.random()*4,
        rot: Math.random()*Math.PI*2,
        vr: (Math.random()-0.5)*0.22,
      };
    }

    function drawHeart(x,y,s,rot,alpha){
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      // –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞ ¬´—Å–µ—Ä–¥—Ü–∞¬ª
      const g = ctx.createRadialGradient(-s*0.2, -s*0.2, s*0.2, 0,0, s*1.2);
      g.addColorStop(0, "rgba(255,255,255,0.95)");
      g.addColorStop(0.25, "rgba(255,79,166,0.95)");
      g.addColorStop(1, "rgba(124,241,255,0.55)");
      ctx.fillStyle = g;

      ctx.beginPath();
      const k = s/16;
      ctx.moveTo(0, 6*k);
      ctx.bezierCurveTo(0, 0, -10*k, 0, -10*k, 6*k);
      ctx.bezierCurveTo(-10*k, 12*k, 0, 14*k, 0, 20*k);
      ctx.bezierCurveTo(0, 14*k, 10*k, 12*k, 10*k, 6*k);
      ctx.bezierCurveTo(10*k, 0, 0, 0, 0, 6*k);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    function tickFx(){
      ctx.clearRect(0,0,W,H);

      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.life -= 0.012;
        p.vy += (p.type==="spark" ? 0.06 : 0.04);
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;

        const alpha = clamp(p.life, 0, 1);

        if(p.type === "spark"){
          ctx.globalAlpha = alpha;
          const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 18);
          g.addColorStop(0, "rgba(255,255,255,0.9)");
          g.addColorStop(0.2, "rgba(255,79,166,0.65)");
          g.addColorStop(1, "rgba(124,241,255,0)");
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(p.x, p.y, 10, 0, Math.PI*2);
          ctx.fill();

          ctx.fillStyle = "rgba(255,255,255,0.85)";
          ctx.fillRect(p.x, p.y, 2, 2);
        } else {
          drawHeart(p.x, p.y, p.size, p.rot, alpha);
        }

        if(p.life <= 0 || p.y > H + 80) particles.splice(i,1);
      }

      requestAnimationFrame(tickFx);
    }

    // ----------------------------
    // –ì–∞–ª–µ—Ä–µ—è: –±–µ—Ä—ë–º –º–∞–∫—Å–∏–º—É–º 4 —Ñ–æ—Ç–æ –∏–∑ Images/1.jpg..4.jpg
    // ----------------------------
    const galleryEl = $("#gallery");
    async function loadGallery(){
      const candidates = ["Images/1.jpg","Images/2.jpg","Images/3.jpg","Images/4.jpg"];
      const ok = [];
      await Promise.all(candidates.map(src => new Promise((resolve)=>{
        const img = new Image();
        img.onload = ()=>{ ok.push(src); resolve(); };
        img.onerror = ()=> resolve();
        img.src = src;
      })));

      galleryEl.innerHTML = "";
      ok.slice(0,4).forEach((src)=>{
        const card = document.createElement("div");
        card.className = "photo";
        const img = document.createElement("img");
        img.src = src;
        img.alt = "–§–æ—Ç–æ";
        card.appendChild(img);
        galleryEl.appendChild(card);
      });

      return ok.length;
    }

    // ----------------------------
    // –°—Ü–µ–Ω—ã
    // ----------------------------
    const scenes = [$("#scene1"), $("#scene2"), $("#scene3")];
    function goScene(n){
      scenes.forEach((s,i)=> s.classList.toggle("active", i===n));
      if(n===0) setHint("–°—Ü–µ–Ω–∞ 1: –ø–æ–¥–ø–∏—à–∏ –±—É–º–∞–∂–∫—É");
      if(n===1) setHint("–°—Ü–µ–Ω–∞ 2: –Ω–∞–∂–º–∏ –Ω–∞ –∑–∞–º–æ–∫");
      if(n===2) setHint("–°—Ü–µ–Ω–∞ 3: —Ä–∞–∑–±–µ—Ä–∏—Å—å —Å –ø–µ—á–∞—Ç—å—é");
    }

    // Scene 1 logic
    const btnYes1 = $("#btnYes1");
    const btnNo1 = $("#btnNo1");
    const paperMsg = $("#paperMsg");
    const paperSub = $("#paperSub");
    const paperBtns = $("#paperBtns");

    let noPressedOnce = false;

    btnNo1.addEventListener("click", ()=>{
      // –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –æ–∫–æ—à–∫–æ, –∫—É—Ä—å–µ—Ä —Ä—É–≥–∞–µ—Ç—Å—è, –ø–æ—Ç–æ–º —Å–Ω–æ–≤–∞, –Ω–æ –±–µ–∑ "–Ω–µ—Ç"
      const panel = $("#paperPanel");
      panel.classList.add("fadeOut");
      setTimeout(()=>{
        panel.classList.remove("fadeOut");
        panel.style.display = "none";
        showToast("–í—ã —á—Ç–æ –±–∞–ª–±–µ—Å? –ù–∞ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –ø—Ä–æ—â–∞—é üòë", 1500);
        setTimeout(()=>{
          panel.style.display = "";
          panel.classList.add("fadeIn");
          setTimeout(()=>panel.classList.remove("fadeIn"), 500);

          noPressedOnce = true;
          paperMsg.textContent = "–õ–∞–¥–Ω–æ. –ü–æ–¥–ø–∏—Å—ã–≤–∞–π. –ü—Ä–∏–Ω–∏–º–∞–µ—à—å –ø–æ—Å—ã–ª–∫—É?";
          paperSub.textContent = "–í—ã–±–æ—Ä–∞ –Ω–µ—Ç üôÇ";
          // —É–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–µ—Ç"
          btnNo1.remove();
        }, 1200);
      }, 260);
    });

    btnYes1.addEventListener("click", ()=>{
      showToast("–ü–æ–¥–ø–∏—Å—å –ø—Ä–∏–Ω—è—Ç–∞. –î–µ—Ä–∂–∏—Ç–µ –∫–æ—Ä–æ–±–∫—É üì¶", 1300);
      goScene(1);
    });

    // Rotation on scene 1 object
    attachInertiaRotation($("#courierWrap"), $("#courierObj"), {rx:-10, ry:16, friction:0.91, speed:0.18, maxX:22});

    // Scene 2: box + lock game
    attachInertiaRotation($("#boxWrap"), $("#boxObj"), {rx:-12, ry:22, friction:0.92, speed:0.16, maxX:26});

    $("#backTo1").addEventListener("click", ()=> goScene(0));

    const lockOverlay = $("#lockOverlay");
    const lockBtn = $("#lockBtn");
    const lockBack = $("#lockBack");
    const lockDone = $("#lockDone");

    let pickerDay, pickerMonth, pickerYear;

    const months = ["—è–Ω–≤–∞—Ä—è","—Ñ–µ–≤—Ä–∞–ª—è","–º–∞—Ä—Ç–∞","–∞–ø—Ä–µ–ª—è","–º–∞—è","–∏—é–Ω—è","–∏—é–ª—è","–∞–≤–≥—É—Å—Ç–∞","—Å–µ–Ω—Ç—è–±—Ä—è","–æ–∫—Ç—è–±—Ä—è","–Ω–æ—è–±—Ä—è","–¥–µ–∫–∞–±—Ä—è"];
    const days = Array.from({length:31}, (_,i)=> String(i+1));
    const years = Array.from({length:41}, (_,i)=> String(2010+i)); // 2010..2050

    function openLock(){
      lockOverlay.classList.add("active");

      if(!pickerDay){
        pickerDay = createWheelPicker($("#pickerDay"), days, 4); // 5
        pickerMonth = createWheelPicker($("#pickerMonth"), months, 10); // –Ω–æ—è–±—Ä—è
        pickerYear = createWheelPicker($("#pickerYear"), years, years.indexOf("2025"));
      }
    }
    function closeLock(){
      lockOverlay.classList.remove("active");
    }

    lockBtn.addEventListener("click", openLock);
    lockBack.addEventListener("click", closeLock);
    lockOverlay.addEventListener("click", (e)=>{
      if(e.target === lockOverlay) closeLock();
    });

    lockDone.addEventListener("click", ()=>{
      const day = Number(pickerDay.value);
      const month = pickerMonth.value;
      const year = Number(pickerYear.value);

      const ok = (day===5 && month==="–Ω–æ—è–±—Ä—è" && year===2025);

      if(ok){
        closeLock();
        showToast("–ö–æ–¥ –≤–µ—Ä–Ω—ã–π. –ó–∞–º–æ–∫ –æ—Ç–∫—Ä—ã–ª—Å—è ‚úÖ", 1200);

        // –∞–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–æ–±–∫–∏
        const obj = $("#boxObj");
        obj.classList.add("openBox");

        setTimeout(()=>{
          // –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç
          goScene(2);
          setTimeout(()=> obj.classList.remove("openBox"), 100);
        }, 850);

      } else {
        // –¥—Ä–æ–∂—å –∑–∞–º–∫–∞
        lockBtn.classList.remove("shake");
        void lockBtn.offsetWidth;
        lockBtn.classList.add("shake");
        showToast("–ù–µ-–∞. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë üòâ", 1200);
      }
    });

    // Scene 3: envelope + seal + bday
    attachInertiaRotation($("#envWrap"), $("#envObj"), {rx:-10, ry:18, friction:0.92, speed:0.16, maxX:26});

    const throwBtn = $("#throwBtn");
    const openBtn = $("#openBtn");
    const envMsg = $("#envMsg");
    const envSub = $("#envSub");
    const envBtns = $("#envBtns");
    const sealBtn = $("#sealBtn");

    const bdayOverlay = $("#bdayOverlay");
    const bdayInput = $("#bdayInput");
    const bdayOk = $("#bdayOk");
    const bdayClose = $("#bdayClose");

    let throwLocked = false;
    let galleryLoaded = false;

    throwBtn.addEventListener("click", ()=>{
      // –≤—Å—ë –¥—Ä–æ–∂–∏—Ç, –æ–∫–Ω–æ "–©–∞—Å –ø–æ —à–µ–µ –ø–æ–ª—É—á–∏—à—å", –∫–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å" –≤—ã—Ç–µ—Å–Ω—è–µ—Ç "–í—ã–±—Ä–æ—Å–∏—Ç—å"
      const stage = $("#stage");
      stage.classList.add("shake");
      showToast("–©–∞—Å –ø–æ —à–µ–µ –ø–æ–ª—É—á–∏—à—å üôÇ", 1200);
      setTimeout(()=> stage.classList.remove("shake"), 380);

      if(!throwLocked){
        throwLocked = true;
        // ¬´—Ä–∞—Å–ø–ª—ã–≤–µ—Ç—Å—è –≤–ª–µ–≤–æ –∏ –≤—ã—Ç–µ—Å–Ω–∏—Ç¬ª
        openBtn.animate([
          { transform: "translateX(0)", filter:"blur(0px)", opacity:1 },
          { transform: "translateX(-8px) scaleX(1.25)", filter:"blur(.2px)", opacity:1 }
        ], { duration: 380, easing: "cubic-bezier(.2,.9,.2,1)" });

        throwBtn.animate([
          { transform:"translateX(0)", opacity:1 },
          { transform:"translateX(18px)", opacity:0 }
        ], { duration: 380, easing: "cubic-bezier(.2,.9,.2,1)" });

        setTimeout(()=> throwBtn.remove(), 360);
      }
    });

    function openBdayPrompt(){
      bdayOverlay.classList.add("active");
      bdayInput.value = "";
      bdayInput.focus({preventScroll:true});
    }
    function closeBdayPrompt(){
      bdayOverlay.classList.remove("active");
    }

    openBtn.addEventListener("click", ()=>{
      // –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å—Å—è –∫ –ø–µ—á–∞—Ç–∏
      const envObj = $("#envObj");
      envObj.classList.add("zoomToSeal");
      setTimeout(()=>{
        envObj.classList.remove("zoomToSeal");
        openBdayPrompt();
      }, 520);
    });

    bdayClose.addEventListener("click", closeBdayPrompt);
    bdayOverlay.addEventListener("click", (e)=>{
      if(e.target === bdayOverlay) closeBdayPrompt();
    });

    // –ú–∞—Å–∫–∞ –¥–¥.–º–º.–≥–≥–≥–≥
    bdayInput.addEventListener("input", ()=>{
      let v = bdayInput.value.replace(/\D/g,"").slice(0,8);
      const dd = v.slice(0,2);
      const mm = v.slice(2,4);
      const yyyy = v.slice(4,8);
      let out = dd;
      if(mm) out += "." + mm;
      if(yyyy) out += "." + yyyy;
      bdayInput.value = out;
    });

    function finishLetter(){
      // –ø–µ—á–∞—Ç—å –ø–∞–¥–∞–µ—Ç
      sealBtn.classList.add("sealDrop");

      // —Å–∞–ª—é—Ç/—Å–µ—Ä–¥—Ü–∞/—Ñ–æ—Ç–æ
      spawnFirework(44);
      spawnHeartsBurst(30);
      setTimeout(()=>spawnHeartsBurst(18), 220);

      // –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –æ–¥–∏–Ω —Ä–∞–∑
      (async ()=>{
        if(!galleryLoaded){
          const count = await loadGallery();
          galleryLoaded = true;
          if(count > 0){
            $("#gallery").classList.add("show");
          }
        } else {
          $("#gallery").classList.add("show");
        }
      })();

      // –ø–æ—Ç–æ–º –≤—Å—ë —É—Ç–∏—Ö–∞–µ—Ç –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å–∫–∞
      setTimeout(()=>{
        $("#envPanel").classList.add("fadeOut");
        setTimeout(()=> $("#envPanel").style.display="none", 260);
      }, 900);

      setTimeout(()=>{
        $("#note").classList.add("show");
        setHint("–ì–æ—Ç–æ–≤–æ üíå");
      }, 1400);
    }

    function checkBday(){
      const v = bdayInput.value.trim();
      const ok = (v === "01.02.2005");
      if(ok){
        closeBdayPrompt();
        showToast("–í–µ—Ä–Ω–æ. –ü–µ—á–∞—Ç—å —Å–Ω–∏–º–∞–µ—Ç—Å—è‚Ä¶ üíó", 1200);
        finishLetter();
      } else {
        showToast("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ üôÇ", 1100);
        sealBtn.classList.remove("shake");
        void sealBtn.offsetWidth;
        sealBtn.classList.add("shake");
      }
    }
    bdayOk.addEventListener("click", checkBday);
    bdayInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") checkBday();
    });

    // –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –ø–µ—á–∞—Ç—å —Ç–æ–∂–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–≤–æ–¥ (–ø—Ä–∏—è—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
    sealBtn.addEventListener("click", ()=>{
      // –µ—Å–ª–∏ —É–∂–µ —Å–Ω—è—Ç–∞ ‚Äî –Ω–∏—á–µ–≥–æ
      if(sealBtn.classList.contains("sealDrop")) return;
      openBdayPrompt();
    });

    // Init
    resizeFx();
    requestAnimationFrame(tickFx);
    setHint("–°—Ü–µ–Ω–∞ 1: –ø–æ–¥–ø–∏—à–∏ –±—É–º–∞–∂–∫—É");

    // –ù–µ–±–æ–ª—å—à–æ–π –∞–Ω—Ç–∏-—Å–∫—Ä–æ–ª–ª –≤ —Ç–µ–ª–µ–≥—Ä–∞–º –≤–µ–±–≤—å—é
    document.addEventListener("touchmove", (e)=>{
      // –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–∏ note (—Å–∫—Ä–æ–ª–ª —Ç–µ–∫—Å—Ç–∞)
      const note = $("#note");
      if(note.classList.contains("show") && note.contains(e.target)) return;
      e.preventDefault();
    }, {passive:false});
  </script>
</body>
</html>
